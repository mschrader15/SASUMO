Metadata:
  # The name will also show up as the main folder for simulation 
  name: test
  author: mcschrader@crimson.ua.edu

SensitivityAnalysis:

  working_root: ${SENSITIVITY_ANALYSIS_OUTPUT} 
  num_runs: 10
  variables: &sa_variables

    FleetComposition:

      variable_name: fleet_composition
      type: fleet_composition
      distribution: &distribution
        type: uniform
        params:
          min: 0.0
          max: 0.7
      
      generator: 
        function: fleet_composition
        arguments:
          kwargs:
            base_route_file: ${SIMULATION_ROOT}/sumo-xml/route-sampler/route-sampler.route.xml
            fleet_compostion: fleet_composition
        output_name: route_file
        passed_to_simulation: True

      
    CarFollowingParameters:
        
      PersonalCar:

        Tau:
          variable_name: tau
          type: car_following_parameter
          distribution:
            type: uniform
            params:
              width: 0.5
              min: 0.5
              max: 3 
        
        Delta:
          variable_name: delta
          type: car_following_parameter
          distribution:
            type: uniform
            params:
              width: 0.5
              min: 1
              max: 10
        
        Accel:
          variable_name: accel
          type: car_following_parameter
          distribution: 
            type: uniform
            params:
              width: 0.1
              min: 0.2
              max: 4
        
        generator_arguments: &PersonalCarArguments         
          common_parameters: |
            #TODO: These are wrong
            length;uniform(2,5)
            speedFactor;uniform(1.1,0.1)
            param; mass; normal(1190,300); [800, 1700]
            vClass;passenger
            carFollowingModel;IDM
            emissionClass;PHEMlight/PC_G_EU4
            
      Class8Truck:
        
        Tau:
          variable_name: tau
          type: car_following_parameter
          distribution:
            type: uniform
            params:
              width: 0.5
              min: 0.5
              max: 3 

        Delta:
          variable_name: delta
          type: car_following_parameter
          distribution:
            type: uniform
            params:
              width: 2
              min: 3
              max: 10
        
        Accel:
          variable_name: accel
          type: car_following_parameter
          distribution: 
            type: uniform
            params:
              min: 1
              max: 3
              width: 0.5
        
        generator_arguments: 
            common_parameters: |
              length;uniform(19,23)
              speedFactor;uniform(1,0.1)
              param; mass; normal(24522,7142); [7000, 43000]
              vClass;trailer
              carFollowingModel;IDM
              emissionClass;PHEMlight/HDV_TT_D_EU6

      generator:
        function: create_vehicle_distribution
        arguments:
          args:
            - PersonalCar
            - Class8Truck
          kwargs:
            output_file_name: vehDist.in.xml
            distribution_size: 100
        output_name: veh_distribution_file
        passed_to_simulation: True
      
    ModelFidelity:
      variable_name: model_fidelity
      type: model_fidelity
      distribution:
        type: uniform sample
        params:
          categorical: 
            - phemlight
            - matlab
  
  Output: 
    module: output.TotalEmissionsHandler
    arguments:
      emissions_xml: ${cwd}/__temp__emissions.out.xml
      sa_parameters: *sa_variables
      start_time:    
    

SimulationCore:
 
  cpu_cores: 60 
  preprocessing: None
  # This should point to a function in the
  manager_function: 
    module: functions.EmissionsSUMOFunc
    # sensitivity analysis sample is inherently the first argument 
    arguments: 

  simulation_function:  
      module: runners.NoTraciSimulationMonteCarlo
      path: ${SIMULATION_ROOT}
      arguments: # Not including the generator arguments marked for being passed to simulation
        kwargs:
          settings: ${SIMULATION_ROOT}/sim-settings/just-sim/06_11_21.json
          #TODO: Let "environmental variables" point to variable in the class
          simulation_output_path: ${cwd}
          emissions_file_name: __temp__emissions.out.xml



FileManager:
  # I want to make moving the files explicitly defined by the user. 
  # At the moment though, manipulated files are automatically moved 
  - None
  # # FileManager specifies how and where to move simulation file inputs 
  # move:
  #   - VEH_DIST_FILE
  #   - ROUTE_FILE





